{{/*
Dynamic scoring panel rendered from the game configuration builder, keeping the legacy visual style.
*/}}
{{define "title"}}Scoring Panel{{end}}
{{define "body"}}
<div class="panel-frame" data-alliance="{{.Alliance}}">
  <header>
    <div class="banner-placeholder"></div>
    <div class="screen-title">{{.Panel.Title}} - <span id="matchName">&nbsp;</span></div>
    <div class="banner-placeholder"></div>
  </header>

  <main>
    <div id="top-controls">
      <button id="commit" onclick="commitMatchScore();" disabled>Commit</button>
    </div>

    <div id="widgetDeck">
      {{if not .Panel.Widgets}}
      <div class="empty-panel text-muted">No widgets configured for this panel.</div>
      {{end}}
      {{range .Panel.Widgets}}
      <div class="widget-card" data-widget-id="{{.Id}}" data-widget-type="{{.Type}}" data-points="{{.PointValue}}"
        data-scoring="{{.ScoringId}}" data-phase="{{.Phase}}" style="grid-column: {{.Position.Col}} / span {{if .Position.ColSpan}}{{.Position.ColSpan}}{{else}}1{{end}}; grid-row: {{.Position.Row}};">
        <div class="widget-header">
          <div class="widget-label">{{.Label}}</div>
          <div class="widget-pill">{{.Type}}</div>
        </div>
        {{if eq .Type "counter"}}
        <div class="counter">
          <button class="counter-decrement scoring-button widget-dec">-1</button>
          <div class="counter-status">
            <div class="counter-main-value widget-value">0</div>
            <div class="counter-label">
              {{if .ScoringId}}
                {{with index $.ScoringPoints .ScoringId}}+{{.}} pts{{end}}
              {{else}}
                +{{.PointValue}} pts
              {{end}}
            </div>
          </div>
          <button class="counter-increment scoring-button widget-inc">+1</button>
        </div>
        {{else if eq .Type "toggle"}}
        <button class="team-button widget-toggle">
          <div class="team-num">
            {{if .ScoringId}}
              {{with index $.ScoringPoints .ScoringId}}{{.}} pts{{end}}
            {{else}}
              {{.PointValue}} pts
            {{end}}
          </div>
          <div class="team-text">Off</div>
        </button>
        {{else if and (eq .Type "multistate") .States}}
        <div class="state-row">
          {{range .States}}
          <button class="endgame-input-button widget-state" data-state="{{.Value}}">
            {{.Label}} {{with index $.ScoringPoints .ScoringId}}({{.}} pts){{end}}
          </button>
          {{end}}
        </div>
        {{else if eq .Type "foul"}}
        <button class="endgame-input-button widget-foul">Add Foul</button>
        {{else if eq .Type "section"}}
        <div class="widget-section">{{.Label}}</div>
        {{else if eq .Type "text"}}
        <div class="text-muted small">{{.Label}}</div>
        {{else}}
        <div class="text-muted small">Not configured</div>
        {{end}}
      </div>
      {{end}}
    </div>

    <div id="bottom-controls">
      <button id="fouls-button" class="scoring-button" onclick="openFoulDialog();" disabled>Fouls</button>
    </div>
  </main>
</div>

<dialog id="fouls-dialog" onclick="closeFoulsDialogIfOutside(event);">
  <div class="dialog-container">
    <div class="dialog-banner">Add Fouls</div>
    <div id="foul-container">
      <button class="foul-button blue" onclick="addFoul('blue', false);">
        <div class="foul-button-label">Blue</div>
      </button>
      <button class="foul-button red" onclick="addFoul('red', false);">
        <div class="foul-button-label">Red</div>
      </button>
      <button class="foul-button blue" onclick="addFoul('blue', true);">
        <div class="foul-button-label">Blue Tech</div>
      </button>
      <button class="foul-button red" onclick="addFoul('red', true);">
        <div class="foul-button-label">Red Tech</div>
      </button>
    </div>
    <button class="dialog-close" autofocus onclick="closeFoulsDialog();" ontouchstart>Close</button>
  </div>
</dialog>
{{end}}

{{define "head"}}
<link rel="manifest" href="/static/manifest/{{.PositionName}}_scoring.manifest">
<meta name="viewport" content="width=device-width, user-scalable=no">
<link href="/static/css/scoring_panel.css" rel="stylesheet">
<link href="/static/css/scoring_panel_dynamic.css" rel="stylesheet">
{{end}}
{{define "script"}}
<script>
  window.panelId = "{{.Panel.Id}}";
  window.panelAlliance = "{{.Alliance}}";
</script>
<script src="/static/js/match_timing.js"></script>
<script src="/static/js/scoring_panel.js"></script>
{{end}}
