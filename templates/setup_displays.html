{{/*
Copyright 2018 Team 254. All Rights Reserved.
Author: pat@patfairbank.com (Patrick Fairbank)

UI for configuring the field displays.
*/}}
{{define "title"}}Display Configuration{{end}}
{{define "body"}}
<div class="row">
  <div class="col-lg-12">
    <legend>Persistent Displays</legend>
    <table class="table table-striped table-hover ">
      <thead>
        <tr>
          <th>ID</th>
          <th># Connected</th>
          <th>IP Address</th>
          <th>Nickname</th>
          <th>Type</th>
          <th>Configuration</th>
          <th>Persistent</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="persistentDisplayContainer"></tbody>
    </table>
    <legend>Connected / Temporary Displays</legend>
    <table class="table table-striped table-hover ">
      <thead>
        <tr>
          <th>ID</th>
          <th># Connected</th>
          <th>IP Address</th>
          <th>Nickname</th>
          <th>Type</th>
          <th>Configuration</th>
          <th>Persistent</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="transientDisplayContainer"></tbody>
    </table>
    <fieldset class="mt-3">
      <legend>Manually Add Display</legend>
      <div class="row g-2 align-items-center">
        <div class="col-md-2">
          <label for="newDisplayId" class="form-label">Display ID</label>
          <input type="text" id="newDisplayId" class="form-control" />
        </div>
        <div class="col-md-2">
          <label for="newDisplayNickname" class="form-label">Nickname</label>
          <input type="text" id="newDisplayNickname" class="form-control" />
        </div>
        <div class="col-md-2">
          <label for="newDisplayType" class="form-label">Type</label>
          <select id="newDisplayType" class="form-select">
            {{range $type, $typeName := .DisplayTypeNames}}
            <option value="{{$type}}">{{$typeName}}</option>
            {{end}}
          </select>
        </div>
        <div class="col-md-3">
          <label for="newDisplayConfiguration" class="form-label">Configuration (key=value&...)</label>
          <input type="text" id="newDisplayConfiguration" class="form-control" />
        </div>
        <div class="col-md-2 form-check mt-4">
          <input type="checkbox" class="form-check-input" id="newDisplayPersistent" checked />
          <label class="form-check-label" for="newDisplayPersistent">Persistent</label>
        </div>
        <div class="col-md-1 mt-4">
          <button type="button" class="btn btn-primary" onclick="addDisplay();">
            Add
          </button>
        </div>
      </div>
    </fieldset>
    <button type="button" class="btn btn-danger float-end" onclick="reloadAllDisplays();">
      Force Reload of All Displays
    </button>
  </div>
</div>

<script id="displayTemplate" type="text/x-handlebars-template">
  <tr{{"{{#unless ConnectionCount}}"}} class="danger"{{"{{/unless}}"}}>
  <td>{{"{{DisplayConfiguration.Id}}"}}</td>
  <td>{{"{{ConnectionCount}}"}}</td>
  <td>{{"{{IpAddress}}"}}</td>
  <td>
    <input type="text" id="displayNickname{{"{{DisplayConfiguration.Id}}"}}" size="30" oninput="markChanged(this);" />
  </td>
  <td>
    <select id="displayType{{"{{DisplayConfiguration.Id}}"}}" onchange="markChanged(this);">
    {{range $type, $typeName := .DisplayTypeNames}}
    <option value="{{$type}}">{{$typeName}}</option>
    {{end}}
    </select>
  </td>
  <td>
    <input type="text" id="displayConfiguration{{"{{DisplayConfiguration.Id}}"}}" size="50"
      oninput="markChanged(this);" />
  </td>
  <td class="text-center">
    <input type="checkbox" id="displayPersistent{{"{{DisplayConfiguration.Id}}"}}" onchange="markChanged(this);" />
  </td>
  <td>
    <button type="button" class="btn btn-primary btn-sm" title="Save Changes"
      onclick="configureDisplay('{{"{{DisplayConfiguration.Id}}"}}');">
    <i class="bi-check-lg"></i>
    </button>
    <button type="button" class="btn btn-danger btn-sm" title="Undo Changes" onclick="undoChanges();">
      <i class="bi-arrow-left"></i>
    </button>
    <button type="button" class="btn btn-success btn-sm" title="Reload Display"
      onclick="reloadDisplay('{{"{{DisplayConfiguration.Id}}"}}');">
    <i class="bi-arrow-clockwise"></i>
    </button>
    <button type="button" class="btn btn-warning btn-sm" title="Remove Persistent Config"
      onclick="removeDisplay('{{"{{DisplayConfiguration.Id}}"}}');">
      <i class="bi-trash"></i>
    </button>
  </td>
  </tr>
</script>
{{end}}
{{define "script"}}
<script src="/static/js/setup_displays.js"></script>
{{end}}
